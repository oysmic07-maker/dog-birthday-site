<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì—°ìœ  ìƒì¼íŒŒí‹° ì´ˆëŒ€ì¥</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg1: #fbf7f3; --bg2: #f3eee8; --paper: #fffdf9;
      --ink: #2b2a28; --muted: #6f6a63; --line: rgba(43,42,40,.14);
      --gold: #b08a4b; --gold2: #d6b57a;
      --shadow: 0 18px 60px rgba(0,0,0,.10);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; color: var(--ink); font-family: "Noto Serif KR", serif;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
    }

    /* --- ì• ë‹ˆë©”ì´ì…˜ --- */
    .reveal { opacity: 0; transform: translateY(20px); transition: 0.8s ease-out; }
    .reveal.active { opacity: 1; transform: translateY(0); }

    .wrap { max-width: 980px; margin: 0 auto; padding: 22px 18px 40px; }
    .card {
      background: rgba(255,253,249,0.9); border: 1px solid var(--line);
      border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden;
    }

    /* --- íˆì–´ë¡œ ì„¹ì…˜ --- */
    .hero { padding: 50px 20px; text-align: center; }
    .topline { color: var(--gold); letter-spacing: 0.2em; font-size: 12px; margin-bottom: 15px; }
    .title { font-family: "Playfair Display", serif; font-size: 38px; margin: 10px 0; }
    .seal {
      display: inline-flex; align-items: center; justify-content: center;
      width: 50px; height: 50px; border-radius: 50%; border: 1px solid var(--gold);
      color: var(--gold); font-weight: bold; margin-bottom: 20px;
    }

    /* --- ìŠ¬ë¼ì´ë” --- */
    .section { padding: 40px 20px; border-top: 1px solid var(--line); }
    .secTitle { font-family: "Playfair Display", serif; font-size: 24px; text-align: center; margin-bottom: 25px; color: var(--gold); }
    .slider { position: relative; border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); }
    .stage { aspect-ratio: 16/10; position: relative; background: #eee; }
    .slideImg { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.8s; }
    .slideImg.on { opacity: 1; }

    /* --- ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ --- */
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
    .photo-item { aspect-ratio: 1; border-radius: 8px; overflow: hidden; cursor: pointer; }
    .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
    .photo-item:hover img { transform: scale(1.1); }

    /* --- ë°©ëª…ë¡ --- */
    .input-box { background: white; padding: 20px; border-radius: 15px; border: 1px solid var(--line); margin-bottom: 20px; }
    input, textarea {
      width: 100%; padding: 12px; border: 1px solid var(--line); border-radius: 8px;
      margin-bottom: 10px; font-family: inherit;
    }
    .btn {
      padding: 10px 20px; border-radius: 999px; border: 1px solid var(--gold);
      background: transparent; color: var(--gold); cursor: pointer; transition: 0.3s; font-weight: 600;
    }
    .btnPrimary { background: var(--gold); color: white; border: none; width: 100%; padding: 15px; margin-top: 5px; }
    .btn:hover { background: var(--gold2); color: white; }

    .guest-item { background: rgba(255,255,255,0.5); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--line); position: relative; }
    .guest-meta { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 5px; }
    .del-btn { color: #ff6b6b; cursor: pointer; border: none; background: none; font-size: 11px; }

    .ribbon { display: flex; justify-content: center; gap: 10px; padding: 20px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="hero reveal">
        <div class="topline">HAPPY BIRTHDAY</div>
        <div class="seal">YE</div>
        <h1 class="title">ì—°ìœ  ìƒì¼íŒŒí‹°</h1>
        <p class="subtitle">2016.02.14 <br> ì†Œì¤‘í•œ ìˆœê°„ë“¤ì„ ê¸°ë¡í•©ë‹ˆë‹¤.</p>
      </div>

      <div class="ribbon reveal">
        <button class="btn" id="btnReload">ë°©ëª…ë¡ ê°±ì‹ </button>
        <button class="btn" onclick="checkAdminAccess()">ê´€ë¦¬ì ëª¨ë“œ</button>
      </div>

      <div class="section reveal">
        <h2 class="secTitle">Highlights</h2>
        <div class="slider">
          <div class="stage">
            <img class="slideImg" id="imgA" alt="slide" />
            <img class="slideImg" id="imgB" alt="slide" />
          </div>
        </div>
      </div>

      <div class="section reveal">
        <h2 class="secTitle">Gallery</h2>
        <div class="photo-grid" id="photoGrid"></div>
      </div>

      <div class="section reveal">
        <h2 class="secTitle">Guestbook</h2>
        <div class="input-box">
          <input id="gName" placeholder="ì‘ì„±ì ì„±í•¨">
          <textarea id="gMsg" placeholder="ì—°ìœ ì—ê²Œ ë”°ëœ»í•œ í•œë§ˆë””ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
          <button class="btn btnPrimary" id="btnPost">ì¶•í•˜ ë©”ì‹œì§€ ë³´ë‚´ê¸° âœ¨</button>
          <div id="postMsg" style="text-align:center; margin-top:10px; font-size:12px;"></div>
        </div>

        <div id="list">
          </div>
      </div>

      <div style="text-align: center; padding: 30px; color: var(--muted); font-size: 12px;">
        Â© 2026 ì—°ìœ ì˜ ìƒì¼íŒŒí‹° | Created with Love
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = "https://dog-birthday-api.onrender.com";
    const IMAGES = [
      "KakaoTalk_20260211_133239688.jpg", "KakaoTalk_20260211_133239688_01.jpg",
      "KakaoTalk_20260211_133239688_02.jpg", "KakaoTalk_20260211_133239688_03.jpg",
      "KakaoTalk_20260211_133239688_04.jpg", "KakaoTalk_20260211_133239688_05.jpg",
      "KakaoTalk_20260211_133239688_06.jpg", "KakaoTalk_20260211_133239688_07.png",
      "KakaoTalk_20260211_133239688_08.jpg", "KakaoTalk_20260211_133239688_09.jpg"
    ];

    let isAdmin = false;

    // 1. ê´€ë¦¬ì ì²´í¬ (ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸)
    function checkAdminAccess() {
      const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      if (pw === "1234") { // ì„¤ì •í•˜ì‹  ë¹„ë°€ë²ˆí˜¸
        isAdmin = true;
        alert("ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‚­ì œ ë²„íŠ¼ í™œì„±í™”)");
        loadGuestbook();
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    }

    // 2. ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ ìƒì„±
    const grid = document.getElementById('photoGrid');
    IMAGES.forEach(src => {
      const item = document.createElement('div');
      item.className = 'photo-item reveal';
      item.innerHTML = `<img src="${src}" loading="lazy">`;
      grid.appendChild(item);
    });

    // 3. ìŠ¬ë¼ì´ë” ë¡œì§
    let cur = 0, isA = true;
    const imgA = document.getElementById('imgA'), imgB = document.getElementById('imgB');
    function nextSlide() {
      const n = (cur + 1) % IMAGES.length;
      const t = isA ? imgB : imgA, active = isA ? imgA : imgB;
      t.src = IMAGES[n];
      t.onload = () => { t.classList.add('on'); active.classList.remove('on'); isA = !isA; cur = n; };
    }
    imgA.src = IMAGES[0]; imgA.classList.add('on');
    setInterval(nextSlide, 3500);

    // 4. ë°©ëª…ë¡ ì €ì¥
    document.getElementById('btnPost').onclick = async () => {
      const name = document.getElementById('gName').value.trim();
      const message = document.getElementById('gMsg').value.trim();
      if(!name || !message) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      try {
        const res = await fetch(`${API_BASE_URL}/api/guestbook`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, message })
        });
        if(res.ok) {
          document.getElementById('gName').value = '';
          document.getElementById('gMsg').value = '';
          loadGuestbook();
        }
      } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
    };

    // 5. ë°©ëª…ë¡ ë¡œë“œ ë° ì‚­ì œ
    async function loadGuestbook() {
      const list = document.getElementById('list');
      try {
        const res = await fetch(`${API_BASE_URL}/api/guestbook`);
        const data = await res.json();
        const rows = Array.isArray(data) ? data : data.items;
        list.innerHTML = rows.map(item => `
          <div class="guest-item reveal">
            <div class="guest-meta">
              <span><b>${item.name}</b></span>
              <span>${new Date(item.created_at || Date.now()).toLocaleDateString()}</span>
            </div>
            <div style="font-size:14px;">${item.message}</div>
            ${isAdmin ? `<button class="del-btn" onclick="deleteEntry('${item._id || item.id}')">ì‚­ì œ</button>` : ''}
          </div>
        `).join('');
        applyReveal();
      } catch(e) { list.innerHTML = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."; }
    }

    async function deleteEntry(id) {
      if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      await fetch(`${API_BASE_URL}/api/guestbook/${id}`, { method: 'DELETE' });
      loadGuestbook();
    }

    // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
    function applyReveal() {
      const obs = new IntersectionObserver(es => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('active'); }));
      document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    }

    document.getElementById('btnReload').onclick = loadGuestbook;
    loadGuestbook();
    applyReveal();
  </script>
</body>
</html><style>
  /* ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
  .del-btn {
    background: #ff4d4d; color: white; border: none;
    padding: 4px 8px; border-radius: 6px; cursor: pointer;
    font-size: 11px; float: right; transition: 0.2s;
  }
  .del-btn:hover { background: #cc0000; }
  
  /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ ê°œì„  */
  input, textarea { border: 1px solid var(--line); border-radius: 10px; padding: 10px; width: 100%; margin-bottom: 8px; }
  .btnPrimary { background: var(--gold); color: white; border: none; font-weight: bold; width: 100%; padding: 12px; }
</style>

<body>
  <div class="wrap">
    <div class="card">
      <div class="ribbon reveal">
        <span class="pill" id="apiPill">API: ì—°ê²° í™•ì¸ ì¤‘</span>
        <button class="btn" id="btnReload">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn btnPrimary" onclick="checkAdminAccess()">ê´€ë¦¬ì</button>
      </div>

      <div class="section reveal">
        <h2 class="secTitle">ë°©ëª…ë¡ ë‚¨ê¸°ê¸°</h2>
        <div class="panel">
          <input id="gName" placeholder="ì‘ì„±ì ì´ë¦„" maxlength="10">
          <textarea id="gMsg" placeholder="ì—°ìœ ì—ê²Œ ì¶•í•˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!" maxlength="200"></textarea>
          <button class="btn btnPrimary" id="btnPost">ì¶•í•˜ ë©”ì‹œì§€ ì €ì¥í•˜ê¸° âœ¨</button>
          <div id="postMsg" class="msg warn" style="margin-top:10px; text-align:center;"></div>
        </div>
      </div>

      <div class="section reveal">
        <h2 class="secTitle">ì¶•í•˜ì˜ ê¸€ë“¤</h2>
        <div id="list" class="list">
          </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = "https://dog-birthday-api.onrender.com";
    const ADMIN_PW = "1234"; // ì‹¤ì œ ìš´ì˜ ì‹œ ë³´ì•ˆì„ ìœ„í•´ ì„œë²„ì—ì„œ ê²€ì¦í•´ì•¼ í•˜ë‚˜, í˜„ì¬ ë‹¨ê³„ì—ì„œ 1ì°¨ ì°¨ë‹¨ìš©

    // 1. ê´€ë¦¬ì ì ‘ê·¼ ì œì–´
    function checkAdminAccess() {
      const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      if (pw === ADMIN_PW) {
        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì‹œ ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™ (ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ë“±ìœ¼ë¡œ ê¶Œí•œ ì „ë‹¬ ê°€ëŠ¥)
        location.href = "./admin.html?token=" + btoa(pw); 
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    }

    // 2. ë°©ëª…ë¡ ì €ì¥ ê¸°ëŠ¥ (POST)
    async function postGuestbook() {
      const name = document.getElementById("gName").value.trim();
      const message = document.getElementById("gMsg").value.trim();
      const out = document.getElementById("postMsg");

      if (!name || !message) {
        out.textContent = "ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì ì–´ì£¼ì„¸ìš”!";
        return;
      }

      try {
        out.textContent = "ì €ì¥ ì¤‘...";
        const response = await fetch(`${API_BASE_URL}/api/guestbook`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, message })
        });

        if (response.ok) {
          out.textContent = "ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰";
          document.getElementById("gName").value = "";
          document.getElementById("gMsg").value = "";
          loadGuestbook(); // ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
        } else {
          throw new Error("ì €ì¥ ì‹¤íŒ¨");
        }
      } catch (e) {
        out.textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
      }
    }

    // 3. ë°©ëª…ë¡ ì‚­ì œ ê¸°ëŠ¥ (DELETE)
    async function deleteEntry(id) {
      if (!confirm("ì •ë§ ì´ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

      try {
        const response = await fetch(`${API_BASE_URL}/api/guestbook/${id}`, {
          method: "DELETE"
        });
        if (response.ok) {
          alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          loadGuestbook();
        }
      } catch (e) {
        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    // 4. ë°©ëª…ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ë° ë Œë”ë§
    async function loadGuestbook() {
      const listEl = document.getElementById("list");
      listEl.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

      try {
        const response = await fetch(`${API_BASE_URL}/api/guestbook`);
        const data = await response.json();
        const rows = Array.isArray(data) ? data : data.items;

        listEl.innerHTML = "";
        rows.forEach(item => {
          const div = document.createElement("div");
          div.className = "item reveal";
          div.innerHTML = `
            <div class="meta">
              <span class="name"><b>${item.name}</b></span>
              <span class="ts">${new Date(item.created_at || Date.now()).toLocaleDateString()}</span>
              <button class="del-btn" onclick="deleteEntry('${item._id || item.id}')">ì‚­ì œ</button>
            </div>
            <div class="txt" style="margin-top:8px">${item.message}</div>
          `;
          listEl.appendChild(div);
        });
        // ìƒˆë¡œ ìƒê¸´ ìš”ì†Œë“¤ì— ì• ë‹ˆë©”ì´ì…˜ ì ìš©
        applyReveal();
      } catch (e) {
        listEl.innerHTML = "ë°©ëª…ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      }
    }

    // ì´ˆê¸° ì‹¤í–‰
    document.getElementById("btnPost").onclick = postGuestbook;
    document.getElementById("btnReload").onclick = loadGuestbook;
    loadGuestbook();

    // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
    function applyReveal() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('active');
        });
      }, { threshold: 0.1 });
      document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    }
    applyReveal();
  </script>
</body>
